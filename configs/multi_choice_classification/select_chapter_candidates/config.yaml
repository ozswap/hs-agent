# Select Chapter Candidates Configuration

name: "select_chapter_candidates"
description: "Refined selection of 1-3 best chapter candidates"

# LLM Call Configuration
call_id: "chapter_selection"
model:
  name: "gemini-2.5-flash-lite"
  provider: "google"
  family: "gemini"
  version: "2.5-flash-lite"
  description: "Balanced model for accurate chapter selection"
  parameters:
    max_tokens: 8192
    temperature: 0.1
    top_p: 0.95

# Input Configuration
input:
  product_description: "{product_description}"
  ranked_candidates: "{ranked_candidates}"
  level: "CHAPTER"
  max_selections: 3

# Parameters
parameters:
  selection_mode: "adaptive"
  max_selections: 3
  min_selections: 1
  quality_focus: true
  diversity_balance: 0.2
  temperature: 0.2

# Output Configuration
output:
  format: "MultiSelectionOutput"
  include_reasoning: true
  include_confidence: true
  include_selection_rationale: true
  schema:
    type: "object"
    description: "prompts/output_schema.md"
    properties:
      selected_candidates:
        type: "array"
        description: "1-3 selected best candidates"
        minItems: 1
        maxItems: 3
        items:
          type: "object"
          properties:
            code:
              type: "string"
              description: "Selected HS code"
            description:
              type: "string"
              description: "Official HS code description"
            confidence:
              type: "number"
              minimum: 0.0
              maximum: 1.0
              description: "Confidence in this selection"
            reasoning:
              type: "string"
              description: "Detailed reasoning for selecting this candidate"
            rank_in_original:
              type: "integer"
              description: "Original ranking position from initial ranking"
      selection_strategy:
        type: "object"
        properties:
          approach:
            type: "string"
            description: "Selection approach used (adaptive/focused/balanced)"
          rationale:
            type: "string"
            description: "Overall rationale for selection strategy"
          confidence_level:
            type: "string"
            enum: ["high", "medium", "low"]
            description: "Overall confidence level for selections"
      metadata:
        type: "object"
        properties:
          total_selections:
            type: "integer"
          selection_timestamp:
            type: "string"

# Prompts (references to files in prompts/ subfolder)
prompts:
  system: "prompts/system.md"
  user: "prompts/user.md"

# Quality Control
quality:
  min_confidence: 0.6
  require_reasoning: true
  validate_selections: true
  check_diversity: true

# Performance
performance:
  timeout_seconds: 45
  max_retries: 2

# Selection Logic
selection_logic:
  selection_strategy: "maximize"  # Explore broadly at chapter level
  high_confidence_threshold: 0.8
  medium_confidence_threshold: 0.6
  ensure_unique_value: true
  avoid_redundancy: true
  quality_guidelines: |
    MAXIMIZE viable selections (aim for 3 unless clearly not justified):
    - Select all chapters that could reasonably apply to this product
    - Err on the side of inclusion rather than exclusion
    - Each selection should represent a distinct classification possibility
    - Cast a wide net - we'll narrow down in later stages
    - Provide detailed reasoning for each selection
    - Only exclude chapters that are clearly irrelevant